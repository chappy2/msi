// Generated by CoffeeScript 1.9.3

/*
Client app Moviedatabase
Collection: gets Data from Server (sqllite database)
functions:
    - create
    - update
    - delete
Model:
    - instance of collection
        - validate
        - create
        - destroy
 */
var Film, FilmList, FilmListView, app, filmList;

Film = (function() {
  Film.attributes = {};

  function Film(values) {
    this.setAttributes(values);
  }

  Film.prototype.validate = function(values) {
    return true;
  };

  Film.prototype.setAttributes = function(values) {
    if (this.validate(values)) {
      console.log(values.title);
      return this.attributes = values;
    }
  };

  Film.prototype.getAttributes = function() {
    return this.attributes;
  };

  return Film;

})();

FilmList = (function() {
  function FilmList() {
    this.storageName = 'demoMoviedatabaseCollection';
    this.fetch();
    this;
  }

  FilmList.prototype.newFilm = function(values) {
    var elem;
    console.log("new film");
    elem = new Film(values);
    this.collection.push(elem);
    return this.save();
  };

  FilmList.prototype.getFilm = function() {
    return false;
  };

  FilmList.prototype.getCollection = function() {
    return this.collection;
  };

  FilmList.prototype.fetch = function() {
    var temp;
    temp = localStorage[this.storageName];
    if (temp == null) {
      console.log('no data in storage');
      this.collection = [];
      return this.newFilm({
        year: 2018,
        title: 'le movie',
        director: 'derpington',
        fsk: '18',
        runtime: '2011-2015'
      });
    } else {
      return this.collection = JSON.parse(temp);
    }
  };

  FilmList.prototype.save = function() {
    return localStorage[this.storageName] = JSON.stringify(this.getCollection());
  };

  return FilmList;

})();

FilmListView = (function() {
  function FilmListView(filmList) {
    this.inputDirector = '#director';
    this.inputFsk = '#fsk';
    this.inputTitle = '#title';
    this.inputYear = '#year';
    this.inputRuntime = '#runtime';
    this.tbodyData = '#contentData';
    this.filmList = filmList;
    this.filmList.fetch();
    console.log('done fetching');
    this.render();
    $(this.inputFsk).on('keydown', (function(_this) {
      return function(event) {
        console.log('enterd something');
        return _this.createOnEnter(event);
      };
    })(this));
    console.log(this.inputFsk);
    this;
  }

  FilmListView.prototype.render = function() {
    var film, trString;
    trString = (function() {
      var i, len, ref, results;
      ref = this.filmList.getCollection();
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        film = ref[i];
        results.push(this.renderFilm(film));
      }
      return results;
    }).call(this);
    $(this.tbodyData).empty();
    return $(this.tbodyData).append(trString.join());
  };

  FilmListView.prototype.renderFilm = function(film) {
    var values;
    values = film.attributes;
    return "<tr><td>" + values.title + "</td><td>" + values.director + "</td><td>" + values.year + "</td><td>" + values.runtime + "</td><td>" + values.fsk + "</td><td><a class='ui-state-default ui-corner-all'><span class='ui-icon ui-icon-trash'></span></a></td><tr>";
  };

  FilmListView.prototype.checkInputFields = function(values) {
    var field, isEmpty;
    isEmpty = (function() {
      var i, len, results;
      results = [];
      for (i = 0, len = values.length; i < len; i++) {
        field = values[i];
        if (field !== '') {
          results.push(true);
        }
      }
      return results;
    })();
    console.log(isEmpty);
    return isEmpty;
  };

  FilmListView.prototype.readInputFields = function() {
    var values;
    values = {};
    values.title = $(this.inputTitle).val();
    values.director = $(this.inputDirector).val();
    values.year = $(this.inputYear).val();
    values.runtime = $(this.inputRuntime).val();
    values.fsk = $(this.inputFsk).val();
    return values;
  };

  FilmListView.prototype.createOnEnter = function(event) {
    var values;
    if (event.keyCode === 13) {
      values = this.readInputFields();
      if (this.checkInputFields(values)) {
        this.filmList.newFilm(values);
        return this.render();
      }
    }
  };

  FilmListView.prototype.deleteFilm = function(event) {
    return true;
  };

  FilmListView.prototype.selectFilmForEdit = function(event) {
    return true;
  };

  FilmListView.prototype.updateFilm = function(event) {
    return true;
  };

  FilmListView.prototype.sort = function() {
    return true;
  };

  return FilmListView;

})();

filmList = new FilmList();

app = new FilmListView(filmList);

app.render();
